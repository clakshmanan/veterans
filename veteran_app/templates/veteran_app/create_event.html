{% extends 'veteran_app/base.html' %}
{% load static %}

{% block title %}Create Event - Admin{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-calendar-plus mr-2"></i>Create New Event
                        {% if user_state %}
                        <small class="text-light ml-2">({{ user_state.name }})</small>
                        {% endif %}
                    </h3>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label for="title">Event Title *</label>
                                    <input type="text" class="form-control" id="title" name="title" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="category">Category *</label>
                                    <input type="text" class="form-control" id="category" name="category" 
                                           placeholder="e.g., Conference, Workshop, Reunion" required>
                                    <small class="form-text text-muted">Enter event category</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="description">Description *</label>
                            <textarea class="form-control" id="description" name="description" rows="4" required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="start_date">Start Date & Time *</label>
                                    <input type="datetime-local" class="form-control" id="start_date" name="start_date" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="end_date">End Date & Time *</label>
                                    <input type="datetime-local" class="form-control" id="end_date" name="end_date" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="venue">Venue *</label>
                                    <input type="text" class="form-control" id="venue" name="venue" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="state">State</label>
                                    {% if user.is_superuser %}
                                    <select class="form-control" id="state" name="state">
                                        <option value="">All States</option>
                                        {% for state in states %}
                                        <option value="{{ state.id }}">{{ state.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <small class="form-text text-muted">Select specific state or leave as "All States"</small>
                                    {% else %}
                                    <input type="text" class="form-control" value="{{ user_state.name }}" readonly>
                                    <small class="form-text text-muted">Events will be created for your state</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="address">Address *</label>
                            <textarea class="form-control" id="address" name="address" rows="2" required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="contact_person">Contact Person *</label>
                                    <input type="text" class="form-control" id="contact_person" name="contact_person" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="contact_phone">Contact Phone *</label>
                                    <input type="tel" class="form-control" id="contact_phone" name="contact_phone" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="registration_fee">Registration Fee (â‚¹)</label>
                                    <input type="number" class="form-control" id="registration_fee" name="registration_fee" 
                                           min="0" step="0.01" value="0">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="max_participants">Max Participants</label>
                                    <input type="number" class="form-control" id="max_participants" name="max_participants" min="1">
                                    <small class="form-text text-muted">Leave empty for unlimited</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="registration_deadline">Registration Deadline</label>
                                    <input type="datetime-local" class="form-control" id="registration_deadline" name="registration_deadline">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="banner_image">Banner Image</label>
                            <input type="file" class="form-control-file" id="banner_image" name="banner_image" accept="image/*">
                            <small class="form-text text-muted">Upload an image for the event banner (optional)</small>
                        </div>
                        
                        <div class="form-group text-center">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-save mr-2"></i>Create Event
                            </button>
                            <a href="{% url 'manage_events' %}" class="btn btn-primary btn-lg ml-2">
                                <i class="fas fa-times mr-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Set minimum date to today
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const minDateTime = now.toISOString().slice(0, 16);
    
    document.getElementById('start_date').min = minDateTime;
    document.getElementById('end_date').min = minDateTime;
    document.getElementById('registration_deadline').min = minDateTime;
    
    // Update end date minimum when start date changes
    document.getElementById('start_date').addEventListener('change', function() {
        document.getElementById('end_date').min = this.value;
    });
});
</script>
{% endblock %}